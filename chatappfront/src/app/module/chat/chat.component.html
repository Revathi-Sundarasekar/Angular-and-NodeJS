<section class="pt-0 pt-lg-4 chat-sec" >
  <div class="container-lg container-fluid px-0">
    <div class="row g-0 shadow">

      <div class="col-md-4" id="profile-panel" [ngClass]="checkwidth > 786 ? 'd-md-block':''">
        <div class="card chat-area dark-bg rounded-0 vh-90">

          <div class="card-header">
            <div class="d-flex" role="search">
              <input class="form-control rounded-2 light-bg border border-0" autocomplete="off" [ngModel]="searchdata" name="searchdata" type="search"
                placeholder="Search" aria-label="Search" (ngModelChange)="somethingChanged($event)">
            </div>
          </div>

          <!--Client profile-->
          <div class="card-body pt-0 px-0" id="contacts">

            <ul *ngFor="let user of filterdata==null?Users:filterdata" class="list-group list-group-flush">

              <li [ngSwitch]="true" class="list-group-item py-3" (click)="getmessage(user,messageform)" role="button" *ngIf="user.Email!=this.login.getUserDetails().data.Email">
                <span *ngSwitchDefault>
                  <p-avatar class="text-uppercase me-2 float-start" size="large" label="{{user.Email[0]}}" styleClass="mr-2" [style]="{'background-color':'#2196F3', 'color': '#ffffff'}" shape="circle"></p-avatar>
                    <div class="float-start">
                      <span class="primary-font fs-5">{{user.Email}}</span><br>
                      <span class="status"> <i class="fa-solid fa-circle" [ngClass]="[user.status=='Online'?'text-success':'text-danger']"></i> {{user.status}}</span>
                    </div>
                  <span class="badge text-bg-danger" *ngIf="user.count!=null">{{user.count}}</span>
                </span>
              </li>

            </ul>
          </div>
        </div>
      </div>
      <!-- chat panel-->
      <div class="col-md-8 border p-0 d-flex align-items-center" [ngClass]="checkwidth < 786?'d-none':''" *ngIf="usernametitle==null">
        <div class="text-center">
          <img src="./assets/img/wallpaper/img-2.png" class="" width="50%" alt="">
          <div class="h1">People's Chat</div>
        </div>
      </div>

      <div class="col-md-8 d-md-block" [ngClass]="usernametitle!=null && checkwidth > 768 ?'d-none':''" *ngIf="usernametitle!=null">
        <div class="row g-0">
          <div class="col-md-12">
            <div id="message" class="border border-bottom-0" >

              <p-virtualScroller [value]="Messagedata" scrollHeight="{{scrollheight}}" [itemSize]="80">

                <ng-template pTemplate="header" class="mb-2">
                  <nav class="navbar bg-white border border-bottom-0">
                    <div class="container-fluid justify-content-start">
                      <button class="btn d-block d-md-none" (click)="backtoprofile()"><i class="fa-solid fa-arrow-left"></i></button>
                      <a class="navbar-brand " href="#">
                        <p-avatar class="text-uppercase me-2" label="{{usernametitle[0]}}" styleClass="mr-2" [style]="{'background-color':'#2196F3', 'color': '#ffffff'}" shape="circle"></p-avatar>
                        {{usernametitle}}({{checkonline}})
                      </a>
                    </div>
                  </nav>
                </ng-template>

                <ng-template #scrollMe let-message pTemplate="item" let-i="index">
                  <div [ngSwitch]="true">
                    <li class="mb-1" *ngSwitchCase="message.from==this.login.getUserDetails().data.Email&& message.Messagetype=='image'">
                      <p-avatar class="ms-2 float-end" label="Me"  [style]="{'background-color':'#2196F3', 'color': '#ffffff'}" shape="circle"></p-avatar>
                      <p class="sent message">
                        <figure> <img src="{{message.Message}}" class="img-fluid"> </figure>
                        <span class="d-flex justify-content-between">
                          <span class="date-time">{{message.Date}}</span>
                          <span class="date-time"><a href="{{message.Message}}" class="btn shadow-none border border-0" download="chatapp_img.jpg"><i class="fa-regular fa-circle-down"></i></a></span>
                        </span>
                      </p>
                    </li>

                    <li class="mb-1" *ngSwitchCase="message.from==this.login.getUserDetails().data.Email&& message.Messagetype!='image'">
                      <p-avatar class="ms-2 float-end" label="Me"  [style]="{'background-color':'#2196F3', 'color': '#ffffff'}" shape="circle"></p-avatar>
                      <p class="sent message px-3">
                        <span> <pre>{{message.Message}}</pre></span>
                        <span class="date-time">{{message.Date}}</span>
                      </p>
                    </li>

                    <li class="mb-1" *ngSwitchCase="message.from!=this.login.getUserDetails().data.Email&&message.Messagetype=='image'">
                      <p-avatar class="text-uppercase me-2 float-start" label="{{avatar}}" styleClass="mr-2" [style]="{'background-color':'#2196F3', 'color': '#ffffff'}" shape="circle"></p-avatar>
                        <p class="replies message px-3 me-2">
                          <figure> <img src="{{message.Message}}" class="img-fluid"> </figure>
                          <span class="d-flex justify-content-between align-items-center">
                            <span class="date-time">{{message.Date}}</span>
                            <span class="date-time"><a href="{{message.Message}}" class="btn text-white shadow-none border border-0" download="chatapp_img.jpg"><i class="fa-regular fa-circle-down"></i></a></span>
                          </span>
                        </p>
                    </li>

                    <li class="mb-1" *ngSwitchDefault>
                      <p-avatar class="text-uppercase me-2 float-start" label="{{avatar}}" styleClass="mr-2" [style]="{'background-color':'#2196F3', 'color': '#ffffff'}" shape="circle"></p-avatar>
                        <p class="replies message px-3 me-2">
                          <span> <pre>{{message.Message}}</pre></span>
                          <span class="date-time">{{message.Date}}</span>
                        </p>
                    </li>
                  </div>
                </ng-template>

                <ng-template pTemplate="footer">
                  <!-- input panel  -->
                  <form #messageform="ngForm" (ngSubmit)="messagesend(messageform,usernametitle)" ngNativeValidate>
                    <div class="d-flex align-items-center py-2 px-2 sandel-bg border-bottom border-end position-relative" id="message-panel">
                      <textarea [ngModel]="Message" #data placeholder="Type here..." name="Message" class="form-control shadow-none" id="validationDefaultUsername" aria-describedby="inputGroupPrepend2"  style="height: 50px" required> </textarea>
                      <button class="btn border border-0 fs-5" type="button" (click)="toggled = !toggled">
                        <i class="fa-regular fa-face-smile"></i>
                      </button>
                      <emoji-mart *ngIf="toggled == true" (emojiClick)="addEmoji($event,data)" title="Pick your emojiâ€¦" emoji="point_up" [hideObsolete]="true" [style]="{  width: '100%', position: 'absolute', bottom: '68px', right: '0' }"></emoji-mart>
                      <a class="btn border border-0 fs-5" data-bs-toggle="modal" data-bs-target="#fileupload"><i class="fa-solid fa-arrow-up-from-bracket"></i></a>
                      <button class="btn border border-0" type="submit" id="addItems"><img src="../../../assets/img/button/send.svg" alt=""></button>
                    </div>
                  </form>
                </ng-template>

              </p-virtualScroller>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</section>

<!-- Modal -->
<div class="modal fade" id="fileupload" #model data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog  modal-dialog-centered" style="max-width: 600px;">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Upload Image</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-0">
        <p-fileUpload name="demo[]" [customUpload]="true" #fileupload [maxFileSize]="1000000" (uploadHandler)="onUpload($event,usernametitle,fileupload)"
          (onUpload)="onUpload($event,usernametitle,fileupload)" accept="image/*">
          <ng-template pTemplate="content">
            <ul *ngIf="uploadedFiles.length">
              <li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}} bytes</li>
            </ul>
          </ng-template>
        </p-fileUpload>
      </div>
    </div>
  </div>
</div>
